pipeline {
    agent any

    stages {
        stage('Deploy to kubernetes') {
            steps {
                withKubeCredentials(kubectlCredentials: [[caCertificate: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJVjdIUVFYNFNWRnN3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qTXhOalF3TlRkYUZ3MHpOREEzTWpFeE5qUTFOVGRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUR2UkE4SFg4a0pGMVhPVGdEdmtzcStQd3FwekFGRXFhanQzNHZiY2tUZEtydXBWNC9va1BRalM4L1cKSHo5TitwUjJoZEt4N1BhSHcvUUluaExqNVdpM0lQNFNFL2hUUzlyejZINkVqWG5SdWFIOXFjOVJ4YzR2dFBOeQo3NGc0UTRNMDJNcGhRNm9HZmc1ZzJZOXVhQis5Z3B6YVdEbGpzRjEzcEUzN2NicjE2Zzkwei85NFUvcGJ4OC96CndTK3YxTWUzN1BzY2xMelFUWnhPY0kzMmwxb2luWlQ3K3hjcGtKTy9mSkNzNmlSS3ZxNlN0a0xJalFLdXNWUU0KSXU5Vld1L3JZWjVDZHl2KzR5VVBIZVNJM3diL05reHpCellWL1EzOWlSVE1MN3k3WVNKT0hjRXdrTDFad0FJNQpaRS81TUhGZUFqYkFobFdFTElNa3V1SThXTkgvQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJSbEIrMldNRnZwaFVmMjY1TWM5dzByK2JhdHhEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQXNOU3FHbDNHUgpjaUJ2Ykk5TlZSWUgrMTVmRCtnVm1Rc3dEcFQ0eEZ5cVBOUVdsSTBsSExqSEptNFhhV2xlTmFqZTBvSG1DNU13CitodVR2SENXWGs0S0tOZkZOYU5XM25Sei9sU2FhUGM1UWd4SUEwTDFqMGZaQk9SYXlKL20zckxSNkZZejZFVCsKVG94THVSeUZLc3V1Ky8wZGhMT3FRYjlVamVocFYzV3ZyWEtBL3RDaUxyWnZxeHcyeUoyTlhhNG1LK2RjYTJ2MwpyNCtycHhGMDlxcDlXR2lGWlIxV05vSU9IcG9aN2NnaXg2K3BpbllxMEZJeHdvSnFjalNzNXI2UUNXeTYxU2JNCjQwSTdRenowdi93MWViM0J5M1RIelhwUmlETk5EazRhMkxFMDJsSG4zcnByRyt1S1haNFhmYXRTUnFiRE5UbHIKM2hHRGlKR0RDRmVJCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K', clusterName: 'eks10', contextName: '', credentialsId: 'k8-token', namespace: 'webapps', serverUrl: 'https://83C41EA992F1BCA5ED643018E80F6CD5.sk1.us-west-1.eks.amazonaws.com']]) {
                 sh "kubectl apply -f deployment-service.yml"   
}
            }
        }
        
        stage('verify Deployment') {
            steps {
                withKubeCredentials(kubectlCredentials: [[caCertificate: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJVjdIUVFYNFNWRnN3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TkRBM01qTXhOalF3TlRkYUZ3MHpOREEzTWpFeE5qUTFOVGRhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUR2UkE4SFg4a0pGMVhPVGdEdmtzcStQd3FwekFGRXFhanQzNHZiY2tUZEtydXBWNC9va1BRalM4L1cKSHo5TitwUjJoZEt4N1BhSHcvUUluaExqNVdpM0lQNFNFL2hUUzlyejZINkVqWG5SdWFIOXFjOVJ4YzR2dFBOeQo3NGc0UTRNMDJNcGhRNm9HZmc1ZzJZOXVhQis5Z3B6YVdEbGpzRjEzcEUzN2NicjE2Zzkwei85NFUvcGJ4OC96CndTK3YxTWUzN1BzY2xMelFUWnhPY0kzMmwxb2luWlQ3K3hjcGtKTy9mSkNzNmlSS3ZxNlN0a0xJalFLdXNWUU0KSXU5Vld1L3JZWjVDZHl2KzR5VVBIZVNJM3diL05reHpCellWL1EzOWlSVE1MN3k3WVNKT0hjRXdrTDFad0FJNQpaRS81TUhGZUFqYkFobFdFTElNa3V1SThXTkgvQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJSbEIrMldNRnZwaFVmMjY1TWM5dzByK2JhdHhEQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQXNOU3FHbDNHUgpjaUJ2Ykk5TlZSWUgrMTVmRCtnVm1Rc3dEcFQ0eEZ5cVBOUVdsSTBsSExqSEptNFhhV2xlTmFqZTBvSG1DNU13CitodVR2SENXWGs0S0tOZkZOYU5XM25Sei9sU2FhUGM1UWd4SUEwTDFqMGZaQk9SYXlKL20zckxSNkZZejZFVCsKVG94THVSeUZLc3V1Ky8wZGhMT3FRYjlVamVocFYzV3ZyWEtBL3RDaUxyWnZxeHcyeUoyTlhhNG1LK2RjYTJ2MwpyNCtycHhGMDlxcDlXR2lGWlIxV05vSU9IcG9aN2NnaXg2K3BpbllxMEZJeHdvSnFjalNzNXI2UUNXeTYxU2JNCjQwSTdRenowdi93MWViM0J5M1RIelhwUmlETk5EazRhMkxFMDJsSG4zcnByRyt1S1haNFhmYXRTUnFiRE5UbHIKM2hHRGlKR0RDRmVJCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K', clusterName: 'eks10', contextName: '', credentialsId: 'k8-token', namespace: 'webapps', serverUrl: 'https://83C41EA992F1BCA5ED643018E80F6CD5.sk1.us-west-1.eks.amazonaws.com']]) {
                sh "kubectl get svc -n webapps"
}
            }
        }
        
        
    }
}
